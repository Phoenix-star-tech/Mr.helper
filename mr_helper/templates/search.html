{% extends 'base.html' %}
{% block title %}Search Results - Mr. Helper{% endblock %}
{% block content %}

<h2>Search Results for "{{ query }}"</h2>

<div class="search-container">
  <form action="{{ url_for('search') }}" method="GET" style="position: relative;">
    <input type="text" id="search-box" name="q" value="{{ query }}" placeholder="Search..." autocomplete="off" required>
    <button type="submit">Search</button>
    <div id="search-suggestions" class="suggestions-box"></div>
  </form>
</div>

<div class="results-container">
  {% if service_results %}
    <h3>Services</h3>
    <ul class="services-list">
      {% for service in service_results %}
        <li>
          <a href="{{ url_for('service', service_name=service.business_type) }}">
            {{ service.business_type }}
          </a>
        </li>
      {% endfor %}
    </ul>
  {% endif %}

  {% if business_results %}
    <h3>Service Providers</h3>
    <ul class="business-list">
      {% for business in business_results %}
        <li>
          <a href="{{ url_for('profile', username=business.username) }}">
            <strong>{{ business.username }}</strong> - {{ business.business_type }}
            <span class="location">{{ business.location }}</span>
          </a>
        </li>
      {% endfor %}
    </ul>
  {% endif %}

  {% if not service_results and not business_results %}
    <p>No results found for "{{ query }}".</p>
  {% endif %}
</div>

<a class="back-link" href="{{ url_for('home') }}">Back to Home</a>

<script>
  const searchBox = document.getElementById('search-box');
  const suggestionsBox = document.getElementById('search-suggestions');

  
  const placeholders = [
    "Search for House Cleaning...",
    "Search for Electrician...",
    "Search for a username...",
    "Search for a location...",
    "Search for Motor Repair...",
    "Search for Kitchen Cleaning..."
  ];

  let currentPlaceholder = 0;
  setInterval(() => {
    searchBox.setAttribute('placeholder', placeholders[currentPlaceholder]);
    currentPlaceholder = (currentPlaceholder + 1) % placeholders.length;
  }, 2000);

  searchBox.addEventListener('input', function () {
    const query = this.value;
    if (query.length === 0) {
      suggestionsBox.innerHTML = '';
      return;
    }

    fetch(`/suggest?term=${encodeURIComponent(query)}`)
      .then(res => res.json())
      .then(suggestions => {
        suggestionsBox.innerHTML = '';
        suggestions.forEach(item => {
          const div = document.createElement('div');
          div.classList.add('suggestion-item');
          div.textContent = item;
          div.onclick = () => {
            searchBox.value = item;
            suggestionsBox.innerHTML = '';
          };
          suggestionsBox.appendChild(div);
        });
      });
  });

  document.addEventListener('click', (e) => {
    if (!suggestionsBox.contains(e.target) && e.target !== searchBox) {
      suggestionsBox.innerHTML = '';
    }
  });
</script>

{% endblock %}